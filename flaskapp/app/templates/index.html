
<html>
<head>
 <!-- The below link for Google Fonts was sourced from https://www.w3schools.com/howto/howto_google_fonts.asp-->
<link rel="shortcut icon" href="../static/cycling.png" type="image/x-icon">
<link href='https://fonts.googleapis.com/css?family=Open%20Sans' rel='stylesheet'>
<title>{{ Title }}</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/styling.css') }}">
<script src = "http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.2.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="../static/dbikes.js"></script>
</head>
 

<script type="text/javascript">
$(window).load(function() {
    $(".loader").fadeOut("slow");
});
</script>
    
<body>
<div class="loader"></div> 

<!--The Map-->
<div id="map"></div>
<div id="legend"><h3>Legend</h3></div>
<div id="legend2"></div>

<div class = "centredetail">
    <div class = "minorinfo">
        <a class="twitter-timeline"  href="https://twitter.com/hashtag/DublinBikes" data-height = "205" data-widget-id="985166481745948673">#DublinBikes Tweets</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>  
    </div>
    <div class = "minorinfo">
        <h2>Dublin Bikes App</h2>
        <p>Welcome to the Dublin Bikes app! Here you can find live data and historical usage trends to better plan your trips<br>
        Please select a marker above or use the dropdowns below</p>
    </div>
    <div class = "minorinfo">
        <div>
            <h3 id="weather"></h3>
            <p id= "temp"></p>
            <p id= "humidity"></p>
            <p id= "wind"></p>
        </div>
    </div>
</div>
    
<div class = "centredetail">    
<!--Weekly Chart-->
<div id = "chart" >
    <div id="chartdiv"></div>
    <div id="curtain"><span>Chart Loads Here...</span></div>
</div>  
<!--The Dropdowns  -->
<div id="dropdownHolder">
<div id="dds">
<!--<div id="myDropdown">-->
<select id='myDropdown' onchange = "insertAddInfo(value); resetDropdown();populateStationBox(stations[value].value[1], stations[value].value[2])"></select>
    
<!--    </div>-->
<select id="dayOfWeek" onchange="insertAddHourlyInfo(value)" >
        <option value="" selected disabled hidden>Choose Day</option>
        <option value =1>Monday</option>
        <option value =2>Tuesday</option>
        <option value =3>Wednesday</option>
        <option value =4>Thursday</option>
        <option value =5>Friday</option>
        <option value =6>Saturday</option>
        <option value =0>Sunday</option>
</select>
</div>
    <div id = "stationInfoBox"></div>
</div> 
    
<!--Hourly Chart-->
<div id = "hourlyChart">
    <div id="chartdiv"></div>
    <div id="curtain"><span>Chart Loads Here...</span></div>
</div>

</div>
<!-- Weather API -->   
<!--<div><a href="#" class="get_weather">Get weather</a></div>-->


<!-- Footer -->
<div id="footer">More info: <a href ="http://www.dublinbikes.ie/">DublinBikes.ie</a></div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  
<!-- The Map -->
<script>
    var stations = [];
    
    function initMap() {
        var dublin = {lat: 53.346880, lng: -6.265615,};
        var map = new  google.maps.Map(document.getElementById('map'), {
          zoom: 13.6,
          center: dublin
        });
        
        var bikeLayer = new google.maps.BicyclingLayer();
        bikeLayer.setMap(map);
        
        
        
        {% for Station in Stations %}
        
        stations.push({
            key: {{ Station.number }},
            value: ['{{ Station.address }}',{{ Station.available_bikes }},{{ Station.available_bike_stands}},{{ Station.number }}]
                      });
        
                      
        var location = {lat: {{ Station.position.lat }}, lng: {{ Station.position.lng }},};
        var stationName = ' {{ Station.name }} ';
        var availablebikes = {{ Station.available_bikes }};
        var availablebikestands = {{ Station.available_bike_stands}};
        var stationNumber = {{ Station.number}};
        var address = ' {{ Station.address }} ';
        var totalBikes = availablebikes + availablebikestands;
        var infoString = 
            '<h4>' + address + '</h4>'+
            '<p> No. of Available Bikes : ' + availablebikes + '</p>' + 
            '<p> No. of Available Stands : ' + availablebikestands + '</p>' +
            '<p class="button button5" onclick="insertAddInfo(' + stationNumber + ');populateStationBox(' + availablebikes + ',' + availablebikestands + '); resetDropdown();resetStation('+ stationNumber +')">More Information</p>'
            ;
        var marker = new google.maps.Marker({
          position: location,
          draggable: false,
          map: map,
          contentString: infoString,    
          title: stationName,
          available: (availablebikes/totalBikes)
            });
       
         var infowindow = new google.maps.InfoWindow({});
         marker.addListener('click', function() {
           infowindow.setContent(this.contentString);
           infowindow.open(map, this);
        });
          
        if (  marker.available >= 0.75) {
                marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
        }
        else if ( marker.available >= 0.5) {
                marker.setIcon('http://maps.google.com/mapfiles/ms/icons/yellow-dot.png');
            }
        else if ( marker.available >= 0.25) {
                marker.setIcon('http://maps.google.com/mapfiles/ms/icons/orange-dot.png');
            }
        else {
                marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
            }
    
    
        {% endfor %}
        
        var icons = {
          green: {
            name: '> 75% Bikes Available',
            icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png'
          },
        yellow: {
            name: '50-75% Bikes Available',
            icon: 'http://maps.google.com/mapfiles/ms/icons/yellow-dot.png'
          },
            orange: {
            name: '25-50% Bikes Available',
            icon: 'http://maps.google.com/mapfiles/ms/icons/orange-dot.png'
          },
            red: {
            name: '< 25% Bikes Available',
            icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
          }
          
        };
        var icons2 = {
          trails: {
            name: '',
            icon: "../static/bike_trails.png"
          }
        };
        var legend = document.getElementById('legend');
        for (var key in icons) {
          var type = icons[key];
          var name = type.name;
          var icon = type.icon;
          var div = document.createElement('div');
          div.innerHTML = '<img src="' + icon + '"height="22" width="22"> ' + name;
          legend.appendChild(div);
        }
         
        var legend2 = document.getElementById('legend');
        for (var key in icons2) {
          var type = icons2[key];
          var name = type.name;
          var icon = type.icon;
          var div = document.createElement('div');
          div.innerHTML = '<img src="' + icon + '"> ' + name;
          legend.appendChild(div);
        }

        map.controls[google.maps.ControlPosition.RIGHT_TOP].push
        (document.getElementById('legend'));
        
//        Create station dropdown from station dictionary created above
        stations = stations.sort(function (a, b) {return a.value[0].localeCompare( b.value[0] );
            });
    
        var listItem = '<option value="" selected disabled hidden>Choose Station</option>'; 
         
        for(i=0; i < stations.length; i++){
            listItem += '<option value='+i+' id='+stations[i].value[3]+'>' + stations[i].value[0] +'</option>';
        }
         
        document.getElementById('myDropdown').innerHTML = listItem;
        }
    

</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRUrdJ4Tz9rLrHrOkwJWpA9QSYNJbWQ0Q&callback=initMap">
</script>
    
<!--
The Dropdown
<script>
        var stations = [];
        var listItem = '<option value="" selected disabled hidden>Choose Station</option>';
        {% for Station in Static %}
        stations.push({
            key: '{{ Station.address }}',
            value: {{ Station.number }}});
            {% endfor %}
            stations = stations.sort(function (a, b) {
            return a.key.localeCompare( b.key );
            });
        for(i=0; i < stations.length; i++){
            listItem += '<option value='+ stations[i].value+'>' + stations[i].key + '</option>';
        }
        document.getElementById('myDropdown').innerHTML = listItem;
</script>
-->
    

<!-- Weather API --> 
<script type="text/javascript">
    $( document ).ready(function() {
        console.log( "document loaded" );
        getWeather();
    });
</script>

</body>
</html>
